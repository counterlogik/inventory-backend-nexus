# Migration `20200418115101-clean-up`

This migration has been generated by addison staples at 4/18/2020, 11:51:01 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."_ItemToTag" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

ALTER TABLE "public"."Item" ADD COLUMN "categoryId" integer  NOT NULL ,
ADD COLUMN "locationId" integer  NOT NULL ;

CREATE UNIQUE INDEX "_ItemToTag_AB_unique" ON "public"."_ItemToTag"("A","B")

CREATE  INDEX "_ItemToTag_B_index" ON "public"."_ItemToTag"("B")

ALTER TABLE "public"."_ItemToTag" ADD FOREIGN KEY ("A")REFERENCES "public"."Item"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ItemToTag" ADD FOREIGN KEY ("B")REFERENCES "public"."Tag"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Item" ADD FOREIGN KEY ("categoryId")REFERENCES "public"."Category"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Item" ADD FOREIGN KEY ("locationId")REFERENCES "public"."Location"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200418112939-fails..20200418115101-clean-up
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator prisma_client {
   provider = "prisma-client-js"
@@ -20,23 +20,25 @@
   world   World  @relation(fields: [worldId], references: [id])
 }
 model Item {
-  id            Int        @default(autoincrement()) @id
-  owner         User       @relation(fields: [ownerId], references: [id])
+  id            Int      @default(autoincrement()) @id
+  owner         User     @relation(fields: [ownerId], references: [id])
   ownerId       Int
-  createdAt     DateTime   @default(now())
-  updatedAt     DateTime   @updatedAt
+  createdAt     DateTime @default(now())
+  updatedAt     DateTime @updatedAt
   description   String
   model         String?
-  categories    Category[]
-  locations     Location[]
+  category      Category @relation(fields: [categoryId], references: [id])
+  categoryId    Int
+  location      Location @relation(fields: [locationId], references: [id])
+  locationId    Int
   spark         Int?
-  count         Int        @default(1)
+  count         Int      @default(1)
   monetaryValue Float
   link          String
   notes         String
-  tags          Tag[]
+  tags          Tag[]    @relation(references: [id])
   image         String
 }
 model Category {
@@ -68,8 +70,9 @@
   owner     User     @relation(fields: [ownerId], references: [id])
   ownerId   Int
   createdAt DateTime @default(now())
   title     String
+  items     Item[]   @relation(references: [id])
   @@unique([ownerId, title])
 }
```


