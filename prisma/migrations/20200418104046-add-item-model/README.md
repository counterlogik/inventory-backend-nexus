# Migration `20200418104046-add-item-model`

This migration has been generated by addison staples at 4/18/2020, 10:40:46 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."Category.title"

DROP INDEX "public"."Location.title"

DROP INDEX "public"."Tag.title"

CREATE TABLE "public"."Item" (
    "count" integer  NOT NULL DEFAULT 1,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "description" text  NOT NULL ,
    "id" SERIAL,
    "image" text  NOT NULL ,
    "link" text  NOT NULL ,
    "model" text   ,
    "monetaryValue" Decimal(65,30)  NOT NULL ,
    "notes" text  NOT NULL ,
    "ownerId" integer  NOT NULL ,
    "spark" integer   ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."_CategoryToItem" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE TABLE "public"."_ItemToLocation" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE TABLE "public"."_ItemToTag" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE UNIQUE INDEX "_CategoryToItem_AB_unique" ON "public"."_CategoryToItem"("A","B")

CREATE  INDEX "_CategoryToItem_B_index" ON "public"."_CategoryToItem"("B")

CREATE UNIQUE INDEX "_ItemToLocation_AB_unique" ON "public"."_ItemToLocation"("A","B")

CREATE  INDEX "_ItemToLocation_B_index" ON "public"."_ItemToLocation"("B")

CREATE UNIQUE INDEX "_ItemToTag_AB_unique" ON "public"."_ItemToTag"("A","B")

CREATE  INDEX "_ItemToTag_B_index" ON "public"."_ItemToTag"("B")

CREATE UNIQUE INDEX "Category.ownerId_title" ON "public"."Category"("ownerId","title")

CREATE UNIQUE INDEX "Location.ownerId_title" ON "public"."Location"("ownerId","title")

CREATE UNIQUE INDEX "Tag.ownerId_title" ON "public"."Tag"("ownerId","title")

ALTER TABLE "public"."Item" ADD FOREIGN KEY ("ownerId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_CategoryToItem" ADD FOREIGN KEY ("A")REFERENCES "public"."Category"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_CategoryToItem" ADD FOREIGN KEY ("B")REFERENCES "public"."Item"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ItemToLocation" ADD FOREIGN KEY ("A")REFERENCES "public"."Item"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ItemToLocation" ADD FOREIGN KEY ("B")REFERENCES "public"."Location"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ItemToTag" ADD FOREIGN KEY ("A")REFERENCES "public"."Item"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ItemToTag" ADD FOREIGN KEY ("B")REFERENCES "public"."Tag"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200418100936-add-tag-model..20200418104046-add-item-model
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator prisma_client {
   provider = "prisma-client-js"
@@ -19,34 +19,62 @@
   name    String
   world   World  @relation(fields: [worldId], references: [id])
 }
+model Item {
+  id            Int        @default(autoincrement()) @id
+  owner         User       @relation(fields: [ownerId], references: [id])
+  ownerId       Int
+  createdAt     DateTime   @default(now())
+  updatedAt     DateTime   @updatedAt
+  description   String
+  model         String?
+  categories    Category[] @relation(references: [id])
+  locations     Location[] @relation(references: [id])
+  spark         Int?
+  count         Int        @default(1)
+  monetaryValue Float
+  link          String
+  notes         String
+  tags          Tag[]      @relation(references: [id])
+  image         String
+}
+
 model Category {
   id          Int      @default(autoincrement()) @id
   owner       User     @relation(fields: [ownerId], references: [id])
   ownerId     Int
   createdAt   DateTime @default(now())
-  title       String   @unique
+  title       String
+  items       Item[]   @relation(references: [id])
   description String?
   image       String?
+
+  @@unique([ownerId, title])
 }
 model Location {
   id          Int      @default(autoincrement()) @id
   owner       User     @relation(fields: [ownerId], references: [id])
   ownerId     Int
   createdAt   DateTime @default(now())
-  title       String   @unique
+  title       String
+  items       Item[]   @relation(references: [id])
   description String?
   image       String?
+
+  @@unique([ownerId, title])
 }
 model Tag {
   id        Int      @default(autoincrement()) @id
   owner     User     @relation(fields: [ownerId], references: [id])
   ownerId   Int
   createdAt DateTime @default(now())
-  title     String   @unique
+  title     String
+  items     Item[]   @relation(references: [id])
+
+  @@unique([ownerId, title])
 }
 model User {
   id        Int      @default(autoincrement()) @id
```


